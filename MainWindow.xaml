<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="LFGL.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:scanning="using:LFGL.Features.Scanning"
    mc:Ignorable="d">

    <Window.SystemBackdrop>
        <MicaBackdrop Kind="BaseAlt" />
    </Window.SystemBackdrop>

    <Grid>
        <Grid.Resources>
            <SolidColorBrush x:Key="GlassBorderBrush" Color="#44FFFFFF" />
            <AcrylicBrush x:Key="CardBackgroundBrush" TintColor="#FF0A0A0A" TintOpacity="0.65" FallbackColor="#1A1A1A" />
            <AcrylicBrush x:Key="FloatingBarBrush" TintColor="#FF000000" TintOpacity="0.75" FallbackColor="#111111" />
            
            <Style TargetType="Button" x:Key="GlassButtonStyle">
                <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}" />
                <Setter Property="BorderBrush" Value="{StaticResource GlassBorderBrush}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="CornerRadius" Value="20" />
                <Setter Property="Padding" Value="20,10" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="FontSize" Value="13" />
            </Style>
        </Grid.Resources>

        <!-- Welcome Overlay -->
        <Grid x:Name="WelcomeOverlay" Background="#EE0A0A0A" Canvas.ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
                <TextBlock x:Name="WelcomeEmoji" Text="ðŸŽ®" FontSize="72" HorizontalAlignment="Center" 
                           Opacity="0" />
                <TextBlock x:Name="WelcomeText" Text="Welcome back," FontSize="18" 
                           Foreground="#888888" HorizontalAlignment="Center" Opacity="0" />
                <TextBlock x:Name="UsernameText" Text="" FontSize="42" FontWeight="Bold" 
                           Foreground="White" HorizontalAlignment="Center" Opacity="0" />
                <TextBlock x:Name="SubtitleText" Text="Let's play something." FontSize="14" 
                           Foreground="#666666" HorizontalAlignment="Center" Opacity="0" Margin="0,8,0,0" />
            </StackPanel>
        </Grid>

        <NavigationView x:Name="NavView" 
                        PaneDisplayMode="Left" 
                        IsBackButtonVisible="Collapsed"
                        IsSettingsVisible="True"
                        SelectionChanged="NavView_SelectionChanged"
                        Background="Transparent"
                        OpenPaneLength="200">
            
            <NavigationView.PaneHeader>
                <StackPanel Padding="12,16" Spacing="4">
                    <TextBlock Text="LFGL" FontWeight="Bold" FontSize="20" Foreground="White" />
                    <TextBlock x:Name="SteamUsernameText" Text="Loading..." FontSize="12" Foreground="#888888" />
                </StackPanel>
            </NavigationView.PaneHeader>
            
            <NavigationView.MenuItems>
                <NavigationViewItem Content="All Games" Tag="All" Icon="Library" IsSelected="True" />
                <NavigationViewItem Content="Favorites" Tag="Favorites" Icon="Favorite" />
                <NavigationViewItemSeparator />
                <NavigationViewItem Content="Steam" Tag="Steam" Icon="Play" />
                <NavigationViewItem Content="Manual" Tag="Manual" Icon="Add" />
            </NavigationView.MenuItems>
            <!-- Main Content Area -->
            <Grid>
                <!-- Content Frame (for Settings page) -->
                <Frame x:Name="ContentFrame" Visibility="Collapsed" />

                <Grid x:Name="LibraryView">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                <!-- Games Grid -->
                <GridView x:Name="GamesGrid" Grid.Row="0" Padding="24,24,24,100" 
                          SelectionMode="None" IsItemClickEnabled="True" ItemClick="GamesGrid_ItemClick">
                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="scanning:GameModel">
                            <Grid Width="230" Height="160" Margin="8" CornerRadius="12" 
                                  Background="{StaticResource CardBackgroundBrush}" 
                                  BorderBrush="{StaticResource GlassBorderBrush}" BorderThickness="1"
                                  PointerEntered="Card_PointerEntered" PointerExited="Card_PointerExited">
                                
                                <Image Source="{x:Bind IconPath}" Stretch="UniformToFill" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center" 
                                       Opacity="0.95"/>
                                
                                <Grid VerticalAlignment="Bottom" Height="70">
                                    <Grid.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="#00000000" Offset="0.0" />
                                            <GradientStop Color="#DD000000" Offset="1.0" />
                                        </LinearGradientBrush>
                                    </Grid.Background>
                                </Grid>
                                
                                <StackPanel VerticalAlignment="Bottom" Padding="14,0,14,10">
                                     <TextBlock Text="{x:Bind Name}" 
                                               FontSize="14" FontWeight="Bold"
                                               Foreground="White" 
                                               TextTrimming="CharacterEllipsis" 
                                               ToolTipService.ToolTip="{x:Bind Name}" />
                                     
                                     <TextBlock Text="{x:Bind Category}" 
                                               FontSize="11" 
                                               Foreground="#AAAAAA" 
                                               Margin="0,2,0,0" />
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </GridView.ItemTemplate>
                    
                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal" HorizontalAlignment="Left" />
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </GridView>
                
                <!-- Empty State -->
                <StackPanel x:Name="EmptyStatePanel" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20" Visibility="Collapsed">
                    <FontIcon Glyph="&#xE774;" FontSize="72" Foreground="#33FFFFFF" />
                    <TextBlock Text="No Games Found" Style="{StaticResource TitleTextBlockStyle}" Foreground="#66FFFFFF" HorizontalAlignment="Center"/>
                    <TextBlock Text="Scan your library or add games manually." Style="{StaticResource BodyTextBlockStyle}" Foreground="#44FFFFFF" HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Floating Action Bar -->
                <Grid Grid.Row="1" Margin="0,0,0,20" HorizontalAlignment="Center">
                    <Grid Background="{StaticResource FloatingBarBrush}" CornerRadius="28" Padding="6" 
                          BorderBrush="{StaticResource GlassBorderBrush}" BorderThickness="1"
                          Translation="0,0,32">
                        <Grid.Shadow>
                            <ThemeShadow />
                        </Grid.Shadow>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="LFGL" VerticalAlignment="Center" FontWeight="Bold" 
                                       Foreground="White" Margin="16,0,8,0" FontSize="16" />
                            <AppBarSeparator Foreground="#22FFFFFF" />
                            <Button x:Name="ScanBtn" Content="ðŸ” Scan" Click="ScanBtn_Click" Style="{StaticResource GlassButtonStyle}" />
                            <Button x:Name="AddBtn" Content="âž• Add" Click="AddBtn_Click" Style="{StaticResource GlassButtonStyle}" />
                        </StackPanel>
                    </Grid>
                </Grid>

                <!-- Loading Overlay -->
                <Grid x:Name="LoadingOverlay" Grid.Row="0" Background="#CC000000" Visibility="Collapsed">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20">
                        <ProgressRing IsActive="True" Width="64" Height="64" Foreground="#7C4DFF" />
                        <TextBlock Text="Scanning..." Foreground="White" FontWeight="SemiBold" FontSize="16" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Grid>
            </Grid>
        </NavigationView>
    </Grid>
</Window>
